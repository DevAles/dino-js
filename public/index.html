<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Dino-js</title>
</head>
<body>
    <div id="game">
        <div id="startScreen">Press Any Key To Start</div>
        <div id="score">0</div>
        <img src="sprites/dino-idle.png" style="display: none;" id="player" class="idle"></img>
        <img src="sprites/obstacle.png" style="display: none;" id="obstacle"></img>
    </div>
    <script type="module">
        import player from './player.js';
        import obstacle from './obstacle.js';
        import keyboardListener from './keyboardListener.js';
        import detectCollision from './detectCollision.js';
        import score from './score.js';

        const startScreen = document.getElementById('startScreen');

        const playerElement = document.getElementById('player');
        const playerVar = player(playerElement);

        const obstacleElement = document.getElementById('obstacle');
        const obstacleVar = obstacle(obstacleElement);

        const scoreElement = document.getElementById('score');
        const scoreVar = score(scoreElement);
        
        const keyboardListenerVar = keyboardListener();

        document.addEventListener('keydown', (event) => {
            startScreen.remove();

            playerVar.setCSS();
            obstacleVar.setCSS();

            playerElement.style.display = 'block';
            obstacleElement.style.display = 'block';
            scoreElement.style.display = 'block';

            setInterval(() => {
                if(!detectCollision(playerElement, obstacleElement)) {
                    obstacleVar.changeObstacleSpeed();
                    scoreVar.increment();
                    scoreVar.updateScore();
                }
            }, obstacleVar.obstacleSpeed);

        }, {once: true});

        setInterval(() => {
            const collision = detectCollision(playerElement, obstacleElement);

            if(collision){
                playerVar.playerAttributes.isDead = true;
                obstacleElement.remove();
                
                if (playerElement.classList.contains('jumping')){
                    playerElement.classList.remove('jumping')
                }

                window.alert('Game Over');
                window.location.reload();
            }
        }, 10);

        document.addEventListener('keydown', (event) => {
            const key = event.key;
            const keyValid = keyboardListenerVar.verifyKey(key);
            
            if (keyValid && playerVar.playerAttributes.isDead == false){
                const commandFunction = playerVar.commands[key];
            
                commandFunction();
            }
        });
    </script>
</body>
</html>